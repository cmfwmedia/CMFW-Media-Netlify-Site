<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CMFW Media Netlify Site</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <main>
        <h1 class="visually-hidden">Heroes examples</h1>

        <div class="px-4 py-5 my-5 text-center">
            <img class="d-block mx-auto mb-4"
                src="https://images.squarespace-cdn.com/content/v1/6424bb54bd8dbd45e169a0a1/0bd039a5-9033-4b7b-bbd8-f9a388aa01c3/logo+no+text.png?format=300w"
                alt="CMFW Media logo">
            <h1 class="display-5 fw-bold text-body-emphasis">CMFW Media, inc.</h1>
            <div class="col-lg-6 mx-auto">
                <p class="lead mb-4">This is the netlify-hosted site for CMFW Media.</p>
                <h3 class="display-5">API endpoint testing</h3>
                <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                    <button id="fetch-btn" type="button" class="btn btn-primary btn-lg px-4 gap-3">Call
                        button</button>
                    <button id="fetch-db" type="button" class="btn btn-primary btn-lg px-4 gap-3">fetchDB</button>
                </div>
            </div>
        </div>
        <div id="injection"></div>
        <div class="container px-4 py-1">
            <div class="row g-4 py-1 row-cols-1 row-cols-lg-3">
                <div class="feature col">
                    <img src="https://images.squarespace-cdn.com/content/65022074520ebd181f024ee1/6e6477ba-2023-4574-8b31-ff234d9cb726/dji+mavic+mini.png?content-type=image%2Fpng"
                        class="img-thumbnail" alt="...">
                    <h3 class="fs-2 text-body-emphasis">CMFW Mavic Air</h3>
                    <h4 class="fs-2 text-body-emphasis">DJI Mavic Mini</h4>
                    <p>Number of Flights: 12</p>
                    <p>Total Flight Time: 12h, 12m, 12s</p>
                    <p>Status: Retired</p>
                    <a href="#" class="icon-link">
                        More
                        <svg class="bi">
                            <use xlink:href="#chevron-right"></use>
                        </svg>
                    </a>
                </div>
                <div class="feature col">
                    <img src="https://images.squarespace-cdn.com/content/65022074520ebd181f024ee1/5f0c541f-df69-43a7-902a-9a338fbeb7de/DJI+Mavic+3E.jpg?content-type=image%2Fjpeg"
                        class="img-thumbnail" alt="...">
                    <h3 class="fs-2 text-body-emphasis">Goose</h3>
                    <h4 class="fs-2 text-body-emphasis">DJI Mavic 3E</h4>
                    <p>Number of Flights: 10</p>
                    <p>Total Flight Time: 12h, 12m, 12s</p>
                    <p>Status: Airworthy</p>
                    <a href="#" class="icon-link">
                        More
                        <svg class="bi">
                            <use xlink:href="#chevron-right"></use>
                        </svg>
                    </a>
                </div>
                <div class="feature col">
                    <img src="https://images.squarespace-cdn.com/content/65022074520ebd181f024ee1/14b3046b-cb01-4793-ad41-dcb5d179d99c/DJI+Air+2S.jpg?content-type=image%2Fjpeg"
                        class="img-thumbnail" alt="...">
                    <h3 class="fs-2 text-body-emphasis">Philip</h3>
                    <h4 class="fs-2 text-body-emphasis">DJI Air 2S</h4>
                    <p>Number of Flights: 176</p>
                    <p>Total Flight Time: 12h, 12m, 12s</p>
                    <p>Status: Airworthy</p>
                    <a href="#" class="icon-link">
                        More
                        <svg class="bi">
                            <use xlink:href="#chevron-right"></use>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const fetchBtn = document.getElementById('fetch-btn')
            const fetchDb = document.getElementById('fetch-db')

            const SpecificDroneUrl = "https://www.dronelogbook.com/inventory/droneDetail.php?id="

            fetchDb.addEventListener('click', async () => {
                const response = await fetch('/.netlify/functions/fetchDb')
                    .then(response => response.json()
                    )
                console.log(response)
                console.log("success, here is the result:" + response)
            })

            fetchBtn.addEventListener('click', async () => {
                const request1 = fetch('/.netlify/functions/getData').then(response => response.json());
                const request2 = fetch('/.netlify/functions/getFlights').then(response => response.json());
                const request3 = fetch('/.netlify/functions/getDrones').then(response => response.json());

                Promise.all([request1, request2, request3])
                    .then(([data1, data2, data3]) => {
                        console.log(data1);
                        console.log(data2);
                        console.log(data3);
                        createElements(data1);

                        function createElements(responseData) {
                            const container = document.querySelector('#injection');

                            if (!container) {
                                console.error('Container element not found');
                                return;
                            }

                            responseData.forEach(arritem => {
                                const div = document.createElement('div');
                                div.classList.add('feature', 'col');

                                const img = document.createElement('img');
                                img.classList.add('img-thumbnail');
                                img.setAttribute('src', arritem.image_url);
                                img.setAttribute('alt', 'drone picture');
                                div.appendChild(img);

                                const h3 = document.createElement('h3');
                                h3.classList.add('fs-2', 'text-body-emphasis');
                                h3.textContent = arritem.name;
                                div.appendChild(h3);

                                const h4 = document.createElement('h4');
                                h4.classList.add('fs-2', 'text-body-emphasis');
                                h4.textContent = arritem.model;
                                div.appendChild(h4);

                                const p = document.createElement('p');
                                p.textContent = `Number of Flights: ${arritem.number_of_flights}`;
                                div.appendChild(p);

                                container.appendChild(div);
                            });
                        }


                    })
                    .catch(error => {
                        console.error(error);
                    });
            })


            // fetchBtnFlights.addEventListener('click', async () => {
            //     const response = await fetch('/.netlify/functions/getFlights')
            //         .then(response => response.json()
            //         )
            //     // console.log(response)

            //     const aggregatedData = {};

            //     response.forEach(item => {
            //         const { duration_seconds, drone_guid } = item;

            //         if (drone_guid in aggregatedData) {
            //             // If drone_guid already exists in aggregatedData, add duration_seconds to its value
            //             aggregatedData[drone_guid].duration += parseFloat(duration_seconds);
            //             aggregatedData[drone_guid].numFlights++;
            //         } else {
            //             // If drone_guid is new, create a new property with duration_seconds as its value
            //             aggregatedData[drone_guid] = {
            //                 duration: parseFloat(duration_seconds),
            //                 numFlights: 1
            //             };
            //         }
            //     });

            //     responseText.innerText = JSON.stringify(aggregatedData)
            //     //  console.log(aggregatedData)
            // })
        })
    </script>
</body>

</html>